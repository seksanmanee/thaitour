{"version":3,"file":"ion-affix.js","sourceRoot":"","sources":["../../src/directives/ion-affix.ts"],"names":[],"mappings":"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","sourcesContent":["import { AfterViewInit, Directive, ElementRef, EventEmitter, Input, OnDestroy, Output, Renderer2 } from '@angular/core';\nimport { IonAffixEvent } from './ion-affix-event';\nimport { IonAffixContainer } from './ion-affix-container';\nimport { adapterFactory } from './adapters/adapter-factory';\n\n/**\n * Directive for creating affixed list headers. Apply it to ion-list-header and pass a reference to ion-content to it.\n *\n * @example\n * <ion-content #content>\n *     <ion-list>\n *         <ion-list-header ion-affix [content]=\"content\">Group 1</ion-list-header>\n *         <ion-item *ngFor=\"let item of items\">{{item}}</ion-item>\n *     </ion-list>\n * </ion-content>\n *\n * @author Jonas Zuberbuehler <jonas.zuberbuehler@gmail.com>\n *\n */\n@Directive({\n    selector: '[ion-affix]'\n})\nexport class IonAffix implements AfterViewInit, OnDestroy {\n\n    @Input('content') content;\n    @Output() onSticky = new EventEmitter<IonAffixEvent>();\n    clone;\n    scrollSubscription;\n    // header that should be made sticky\n    headerElement;\n    // direct parent of header (can be ion-list, ion-card etc.)\n    containerElement;\n    // the element that scrolls (i.e., ion-content or ion-scroll)\n    scrollContainer: IonAffixContainer;\n\n    constructor(private element: ElementRef, private renderer: Renderer2) {\n    }\n\n    ngAfterViewInit(): void {\n        // getting container\n        this.scrollContainer = adapterFactory(this.content);\n        this.headerElement = this.element.nativeElement;\n        this.containerElement = this.headerElement.parentElement;\n        const headerHeight = this.headerElement.getBoundingClientRect().height;\n        const right = window.innerWidth - this.headerElement.getBoundingClientRect().width - this.headerElement.getBoundingClientRect().left;\n        const left = this.headerElement.getBoundingClientRect().left;\n        let scrollClientTop = this.scrollContainer.getClientTop();\n        let containerTop = this.containerElement.offsetTop;\n        let containerBottom = containerTop + this.containerElement.getBoundingClientRect().height;\n        // initially checking if affix needs to be shown\n        this.updateSticky(this.scrollContainer.getScrollTop(), containerTop, containerBottom, scrollClientTop, headerHeight, left, right, true);\n\n        const onScroll = () => {\n            const scrollTop = this.scrollContainer.getScrollTop();\n            scrollClientTop = this.scrollContainer.getClientTop();\n            containerTop = this.containerElement.offsetTop;\n            containerBottom = containerTop + this.containerElement.getBoundingClientRect().height;\n            this.updateSticky(scrollTop, containerTop, containerBottom, scrollClientTop, headerHeight, left, right, this.scrollContainer.isScrollingDown());\n        };\n        // subscribing to scroll events\n        this.scrollSubscription = this.scrollContainer.onScroll().subscribe(onScroll);\n    }\n\n    private updateSticky(scrollTop, containerTop, containerBottom, scrollClientTop, headerHeight, left, right, downwards) {\n        // check if scrollTop is within list boundaries\n        if (scrollTop > 0 && scrollTop >= containerTop && scrollTop <= containerBottom) {\n            if (!this.clone) {\n                this.clone = this.headerElement.cloneNode(true);\n                this.containerElement.insertBefore(this.clone, this.headerElement);\n                this.scrollContainer.appendFixedHeader(this.headerElement);\n                this.onSticky.emit({sticky: true, affix: this});\n                // for fancy transition efx if scrolling down\n                if (downwards) {\n                    this.applyStyles(left, right);\n                } else {\n                    this.applyStyles(0, 0);\n                }\n                setTimeout(() => {\n                    this.renderer.setStyle(this.headerElement, 'right', '0px');\n                    this.renderer.setStyle(this.headerElement, 'left', '0px');\n                }, 0);\n            }\n            // transform vertical position to push fixed header up/down\n            if (scrollTop <= containerBottom && scrollTop >= (containerBottom - headerHeight)) {\n                const delta = scrollClientTop - (scrollTop - (containerBottom - headerHeight));\n                this.renderer.setStyle(this.headerElement, 'transform', `translate3d(0px, ${delta}px, 0px)`);\n                this.renderer.setStyle(this.headerElement, '-webkit-transform', `translate3d(0px, ${delta}px, 0px)`);\n            } else {\n                this.renderer.setStyle(this.headerElement, 'transform', `translate3d(0px, ${scrollClientTop}px, 0px)`);\n                this.renderer.setStyle(this.headerElement, '-webkit-transform', `translate3d(0px, ${scrollClientTop}px, 0px)`);\n            }\n        } else {\n            this.reset();\n        }\n    }\n\n    private reset() {\n        if (this.clone) {\n            this.containerElement.insertBefore(this.headerElement, this.clone);\n            this.clearStyles();\n            this.clone.remove();\n            this.clone = null;\n            this.onSticky.emit({sticky: false, affix: this});\n        }\n    }\n\n    private applyStyles(left, right) {\n        this.renderer.setStyle(this.headerElement, 'right', `${right}px`);\n        this.renderer.setStyle(this.headerElement, 'left', `${left}px`);\n        this.renderer.setStyle(this.headerElement, 'transition', 'left 0.1s ease-out, right 0.1s ease-out');\n        this.renderer.setStyle(this.headerElement, 'z-index', '2');\n        this.renderer.setStyle(this.headerElement, 'position', 'absolute');\n        this.renderer.setStyle(this.headerElement, 'width', 'auto');\n        this.renderer.setStyle(this.headerElement, 'top', '0px');\n    }\n\n    private clearStyles() {\n        this.renderer.removeStyle(this.headerElement, 'position');\n        this.renderer.removeStyle(this.headerElement, 'z-index');\n        this.renderer.removeStyle(this.headerElement, 'transition');\n        this.renderer.removeStyle(this.headerElement, 'top');\n        this.renderer.removeStyle(this.headerElement, 'transform');\n        this.renderer.removeStyle(this.headerElement, '-webkit-transform');\n        this.renderer.removeStyle(this.headerElement, 'left');\n        this.renderer.removeStyle(this.headerElement, 'right');\n        this.renderer.removeStyle(this.headerElement, 'width');\n    }\n\n    ngOnDestroy(): void {\n        this.reset();\n        this.scrollSubscription.unsubscribe();\n    }\n}\n"]}